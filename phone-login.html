<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<title>Animal App</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/style.css">
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/function.js"></script>
<script type="text/javascript">

var lat, longi;
var onSuccess = function(position) {
					  
			lat =  position.coords.latitude;
			longi = position.coords.longitude;
			
			var loc_msg = 'Latitude: ' + position.coords.latitude + "\n";
			loc_msg += 'Longitude: ' + position.coords.longitude + "\n";
			alert(loc_msg);
    };

function onError(error){
        alert('message: ' + error.message + '\n');
}


function checkdeviceLogin(){
	
	$("#loadingImg").fadeIn();
	
cordova.plugins.diagnostic.isGpsLocationEnabled(function(enabled){
		
	navigator.geolocation.getCurrentPosition(onSuccess, onError, {maximumAge:7000, timeout:3000, enableHighAccuracy:true});
	
	setTimeout(function(){
	
	if(localStorage.getItem("cust_id") != null)
	{			
		var customer_login = localStorage.getItem("cust_id");
		$.ajax({
		 type: 'POST',
		 url: siteurl + "account/setinfo/lat",
		 dataType: 'json',
		 data: {login_id:customer_login, latitude:lat, longitude:longi},
		 crossDomain: true,
		 success: function(data){
			
			if(data['success'])
			{
				window.location = 'swipe.html';			
			}	
		  }
	   });
		
	}
	$("#loadingImg").fadeOut();
	}, 3000);
	
	
}, function(error){
    cordova.plugins.diagnostic.switchToLocationSettings();
}); 
	
}

document.addEventListener("deviceready", checkdeviceLogin, false);
</script>
</head>
<body>
<div class="full-height center">
    <div class="container">
        <div class="phone-login" id="mobile_no_container">
            <h3>Enter your mobile number</h3>
            <div class="phone-login-field">
                <div class="countryflag"><img src="images/flag1.png" alt=""></div>
                <input type="number" maxlength="12" name="customer_mobile" id="customer_mobile" class="form-control" placeholder="+1">
            </div>
            <button type="button" class="btn btn-block btn-danger" onClick="loginNow();">NEXT</button>
        </div>
        
        <div class="phone-login" id="otp_container" style="display:none;">
            <h3>Enter OTP</h3>
            <input type="hidden" name="customer_mob" id="customer_mob">
            <div class="phone-login-field">
                <input type="number" maxlength="6" name="customer_otp" id="customer_otp" class="form-control" placeholder="Enter OTP">
            </div>
            <button type="button" class="btn btn-block btn-danger" onClick="validateOtp();">Submit</button>
        </div>
    </div>
</div>
<div class="loadermain" id="loadingImg">
</body>
<script type="text/javascript">
function validateOtp(){
	var customer_mob = $('#customer_mob').val();
	var customer_otp = $('#customer_otp').val();
	var action_url = siteurl + 'account/login/otp';	
	$.ajax({
	 type: 'POST',
	 url: action_url,
	 dataType: 'json',
	 data: {customer_mobile:customer_mob,otp:customer_otp, latitude: lat, longitude:longi},
	 crossDomain: true,
	 success: function(data){
		
	   	if(data['success'])
		{
			
			$('#mobile_no_container').remove();
			$('#customer_mob').val(data['success']['no']);
			$('#otp_container').show();
			localStorage.setItem('cust_id', data['success']['id']);
			if(data['success']['redirect'] == 1)
			{				
				window.location = 'select_info.html';
			}else if(data['success']['redirect'] == 2)
			{				
				window.location = 'profile-info.html';
			}else{				
				window.location = 'swipe.html';
			}
		}
		
		if(data['error'])
		{
			$('#customer_otp').addClass('req');
			alert(data['error']['otp']);
		}
	 }
   });
}
</script>
</html>