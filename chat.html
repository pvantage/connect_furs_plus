<!doctype html>
<html lang="en" class="chatbodycn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author" content="">
<title>Animal App</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/style.css">
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/function.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
 checkLogin();
 
 function checkdeviceLogin(){
	loadChat();
}
document.addEventListener("deviceready", checkdeviceLogin, false);

</script>
</head>
<body class="chat-application">
<nav class="navbar navbar-expand-lg navbar-light bg-light navmainsection">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation"> 
    <span class="navbar-toggler-icon"><img src="images/menubar.png"/></span>
  </button>
  
  <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
      <li class="nav-item active">
        <a class="nav-link" href="swipe.html">Home <span class="sr-only">Profile</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="javascript:void(0);">Setting</a>
     </li>
	   <li class="nav-item">
        <a class="nav-link" href="javascript:void(0);" onClick="logOut();">Logout</a>
    </ul>
  </div>
</nav>
<div class="app-content content">
    <div class="chat-wrapper container mt-3">
            <h1 class="red"><a class="bkbtn" href="your-connections.html"><i class="fa fa-long-arrow-left" aria-hidden="true"></i> Back</a></h1>
            <section class="chat-app-window">           
                <div class="chats"></div>           
              </section>         
              
              <section class="chat-app-form">
                <div class="chat-app-input d-flex">
                  <fieldset class="form-group position-relative has-icon-left col-10 m-0">               
                    <input type="text" placeholder="Type your message" name="chat_txt" id="chat_txt" class="form-control">               
                  </fieldset>
                </div>
              </section>
        </div>
</div>
<script type="text/javascript">
var login_id = localStorage.getItem('cust_id');
function loadChat(){
$.ajax({
	 type: 'POST',
	 url: siteurl + 'account/chat',
	 dataType: 'json',
	 data: {chat_to:gup('id'),login_id:login_id},
	 crossDomain: true,
	 success: function(data){
		 if(data['success'])
		 {
			 $('.chats').html(data['success']);
		 }
	  }
   });
}

function addChat(){
var message = $('#chat_txt').val();

if(message != ''){
$('#chat_txt').val('');
$.ajax({
	 type: 'POST',
	 url: siteurl + 'account/chat/addNew',
	 dataType: 'json',
	 data: {chat_to: gup('id'), login_id:login_id, message: message},
	 crossDomain: true,
	 success: function(data){
			 $('.chats').html(data['success']);
	   }
    });
  }
}

$(document).ready(function(e){
    $('#chat_txt').on("keypress", function(e){
		if(e.keyCode == 13){
			addChat();
		}
	});
	
	setInterval(function (){
		loadChat();
	},3000);
});
</script>
</body>
</html>